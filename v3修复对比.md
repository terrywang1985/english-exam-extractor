# v3ä¿®å¤å¯¹æ¯” - é—®é¢˜å‰åå¯¹ç…§

## ğŸ”´ é—®é¢˜1ï¼šåŒä¸‹åˆ’çº¿

### âŒ ä¿®å¤å‰ï¼ˆv2ç‰ˆæœ¬ï¼‰
```html
<!-- å®Œå½¢å¡«ç©ºæ–‡æœ¬ -->
because I was in <bdo class="mathjye-underline">ï¼ˆ16ï¼‰</bdo> about my future
```
**æ˜¾ç¤ºæ•ˆæœï¼š** `because I was in ï¼ˆ16ï¼‰________ about my future`
- åŸæœ‰çš„ä¸‹åˆ’çº¿
- åˆåŠ äº†ä¸€æ¡æ›¿æ¢çš„ä¸‹åˆ’çº¿
- **ç»“æœï¼š2æ¡ä¸‹åˆ’çº¿**

### âœ… ä¿®å¤åï¼ˆv3ç‰ˆæœ¬ï¼‰
```javascript
// å®Œå½¢å¡«ç©ºä¸“é—¨å¤„ç†ï¼šé¢˜å·ä¸åŠ ä¸‹åˆ’çº¿
htmlContent = htmlContent.replace(/ï¼ˆ(\d+)ï¼‰<!--BA-->/g, '<span class="cloze-blank">ï¼ˆ$1ï¼‰</span>');
```
**æ˜¾ç¤ºæ•ˆæœï¼š** `because I was in ï¼ˆ16ï¼‰ about my future`
- **ç»“æœï¼šé¢˜å·æ¸…æ™°ï¼Œæ²¡æœ‰å¤šä½™ä¸‹åˆ’çº¿**

---

## ğŸ”´ é—®é¢˜2ï¼šå®Œå½¢å¡«ç©ºé€‰é¡¹ä¸¢å¤±

### âŒ ä¿®å¤å‰ï¼ˆv2ç‰ˆæœ¬ï¼‰
**åŸå§‹HTMLï¼š**
```html
<table class="composition2">
  <tr><td>16. </td><td>A.anything</td><td>B.anyone</td><td>C.anytime</td><td>D.anywhere</td></tr>
  <tr><td>17. </td><td>A.emotion</td><td>B.improvement</td><td>C.situation</td><td>D.honor</td></tr>
  ...
</table>
```

**ä»£ç é—®é¢˜ï¼š**
```javascript
// ç§»é™¤äº†æ‰€æœ‰tableï¼ŒåŒ…æ‹¬é€‰é¡¹è¡¨æ ¼
clone.querySelectorAll('table').forEach(table => table.remove());
```

**æå–ç»“æœï¼š** å®Œå½¢å¡«ç©ºåªæœ‰æ–‡ç« ï¼Œæ²¡æœ‰é€‰é¡¹ âŒ

### âœ… ä¿®å¤åï¼ˆv3ç‰ˆæœ¬ï¼‰
**æ–°ä»£ç ï¼š**
```javascript
if (isCloze) {
  // å…ˆæå–é€‰é¡¹è¡¨æ ¼ï¼ˆåœ¨ç§»é™¤ä¹‹å‰ï¼‰
  const optionsTable = clone.querySelector('table.composition2');
  if (optionsTable) {
    question.clozeOptionsHTML = `<table class="cloze-options-table">${tableClone.innerHTML}</table>`;
  }
}
```

**æå–ç»“æœï¼š**
```
æ–‡ç« å†…å®¹
ï¼ˆ16ï¼‰ï¼ˆ17ï¼‰ï¼ˆ18ï¼‰...

+---------------------------------------------------+
| 16.  | A.anything | B.anyone  | C.anytime | D.anywhere |
+---------------------------------------------------+
| 17.  | A.emotion  | B.improvement | C.situation | D.honor |
+---------------------------------------------------+
...
```
**ç»“æœï¼šé€‰é¡¹å®Œæ•´æ˜¾ç¤º** âœ…

---

## ğŸ”´ é—®é¢˜3ï¼šé˜…è¯»ç†è§£æ¢è¡Œä¸¢å¤±

### âŒ ä¿®å¤å‰ï¼ˆv2ç‰ˆæœ¬ï¼‰
**åŸå§‹HTMLï¼š**
```html
<div class="pt1">
  Once, there was a big apple tree...<br>
  <br>
  A long time ago, the boy came back...<br>
  <br>
  "Come and play with me," the tree said.<br>
</div>
```

**ä»£ç é—®é¢˜ï¼š**
```javascript
// ä½¿ç”¨textContentï¼Œæ‰€æœ‰<br>è¢«å¿½ç•¥
let content = clone.textContent || clone.innerText || '';
```

**æå–ç»“æœï¼š**
```
Once, there was a big apple tree... A long time ago, the boy came back... "Come and play with me," the tree said.
```
**æ•´æ®µæ–‡å­—æŒ¤åœ¨ä¸€èµ·ï¼Œæ— æ³•é˜…è¯»** âŒ

### âœ… ä¿®å¤åï¼ˆv3ç‰ˆæœ¬ï¼‰
**æ–°ä»£ç ï¼š**
```javascript
if (isReading) {
  let htmlContent = clone.innerHTML;
  // ä¿ç•™<br>æ ‡ç­¾ï¼Œè½¬æ¢ä¸ºæ®µè½
  htmlContent = htmlContent.replace(/<br>/g, '</p><p>');
  question.contentHTML = `<div class="reading-content"><p>${htmlContent}</p></div>`;
}
```

**æå–ç»“æœï¼š**
```
Once, there was a big apple tree...

A long time ago, the boy came back...

"Come and play with me," the tree said.
```
**æ®µè½åˆ†æ˜ï¼Œæ˜“äºé˜…è¯»** âœ…

---

## æ ¸å¿ƒä¿®å¤ä»£ç å¯¹æ¯”

### extractSingleQuestionå‡½æ•° - å…³é”®æ”¹åŠ¨

#### v2ç‰ˆæœ¬ï¼ˆæœ‰é—®é¢˜ï¼‰
```javascript
function extractSingleQuestion(questionElement, sectionType) {
  const clone = contentEl.cloneNode(true);
  
  // âŒ ç§»é™¤æ‰€æœ‰table
  clone.querySelectorAll('table').forEach(table => table.remove());
  
  // âŒ ç›´æ¥æ›¿æ¢ä¸‹åˆ’çº¿ï¼Œä¸åŒºåˆ†ç±»å‹
  const underlines = clone.querySelectorAll('.mathjye-underline');
  underlines.forEach(el => {
    el.outerHTML = '<span class="answer-blank">________</span>';
  });
  
  // âŒ ä½¿ç”¨textContentï¼Œä¸¢å¤±<br>
  let content = clone.textContent.trim();
  
  return { content };
}
```

#### v3ç‰ˆæœ¬ï¼ˆå·²ä¿®å¤ï¼‰
```javascript
function extractSingleQuestion(questionElement, sectionType) {
  const clone = contentEl.cloneNode(true);
  
  // âœ… è¯†åˆ«é¢˜å‹
  const isCloze = sectionType && sectionType.includes('å®Œå½¢å¡«ç©º');
  const isReading = sectionType && sectionType.includes('é˜…è¯»');
  
  if (isCloze) {
    // âœ… å®Œå½¢å¡«ç©ºï¼šå…ˆä¿å­˜é€‰é¡¹è¡¨æ ¼
    const optionsTable = clone.querySelector('table.composition2');
    if (optionsTable) {
      question.clozeOptionsHTML = `<table class="cloze-options-table">${tableClone.innerHTML}</table>`;
      optionsTable.remove();
    }
    
    // âœ… é¢˜å·ä¸åŠ ä¸‹åˆ’çº¿
    htmlContent = htmlContent.replace(/ï¼ˆ(\d+)ï¼‰<!--BA-->/g, '<span class="cloze-blank">ï¼ˆ$1ï¼‰</span>');
    
    // âœ… ä¿ç•™<br>ä¸ºæ®µè½
    const paragraphs = htmlContent.split('<br>');
    question.contentHTML = `<div class="cloze-passage">${formattedContent}</div>`;
    
  } else if (isReading) {
    // âœ… é˜…è¯»ç†è§£ï¼šä¿ç•™HTMLï¼Œè½¬æ¢<br>
    let htmlContent = clone.innerHTML;
    htmlContent = htmlContent.replace(/<br>/g, '</p><p>');
    question.contentHTML = `<div class="reading-content"><p>${htmlContent}</p></div>`;
    
  } else {
    // âœ… æ™®é€šé¢˜ç›®ï¼šç§»é™¤tableï¼Œå¤„ç†ä¸‹åˆ’çº¿
    clone.querySelectorAll('table').forEach(table => table.remove());
    const underlines = clone.querySelectorAll('.mathjye-underline');
    underlines.forEach(el => {
      el.outerHTML = '<span class="answer-blank">________</span>';
    });
    question.content = clone.textContent.trim();
  }
  
  return question;
}
```

---

## æµ‹è¯•ç»“æœå¯¹æ¯”

| é¢˜å‹ | v2ç‰ˆæœ¬é—®é¢˜ | v3ç‰ˆæœ¬è¡¨ç° |
|-----|-----------|-----------|
| **é€‰æ‹©é¢˜** | âœ… æ­£å¸¸ | âœ… æ­£å¸¸ |
| **å¡«ç©ºé¢˜** | âœ… æ­£å¸¸ | âœ… æ­£å¸¸ |
| **å®Œå½¢å¡«ç©º** | âŒ åŒä¸‹åˆ’çº¿<br>âŒ é€‰é¡¹ä¸¢å¤± | âœ… é¢˜å·æ­£å¸¸<br>âœ… é€‰é¡¹å®Œæ•´ |
| **é˜…è¯»ç†è§£** | âŒ æ¢è¡Œä¸¢å¤±<br>âŒ æ–‡å­—æŒ¤åœ¨ä¸€èµ· | âœ… æ®µè½åˆ†æ˜<br>âœ… æ ¼å¼æ¸…æ™° |

---

## æ–°å¢CSSæ ·å¼

### å®Œå½¢å¡«ç©ºé¢˜å·æ ·å¼
```css
.cloze-blank {
    font-weight: bold;
    color: #0066cc;
    margin: 0 2px;
}
```

### å®Œå½¢å¡«ç©ºé€‰é¡¹è¡¨æ ¼æ ·å¼
```css
.cloze-options-table {
    width: 100%;
    margin: 15px 0;
    border-collapse: collapse;
    background: #f8f9fa;
    border: 1px solid #dee2e6;
}

.cloze-options-table td {
    padding: 10px;
    border: 1px solid #dee2e6;
}

.cloze-options-table td:first-child {
    font-weight: bold;
    color: #0066cc;
    text-align: center;
}
```

### é˜…è¯»ç†è§£æ®µè½æ ·å¼
```css
.reading-content {
    line-height: 2;
    margin: 15px 0;
}

.reading-content p {
    margin: 12px 0;
}
```

---

## ä½¿ç”¨æŒ‡å—

### é‡æ–°åŠ è½½æ‰©å±•
1. æ‰“å¼€ `chrome://extensions/`
2. æ‰¾åˆ°"è‹±è¯­è¯•å·æå–å™¨ v2.0"
3. ç‚¹å‡»åˆ·æ–°å›¾æ ‡ ğŸ”„
4. ç¡®ä¿ç‰ˆæœ¬æ›´æ–°åˆ°v3

### æµ‹è¯•æ­¥éª¤
1. æ‰“å¼€ `è¯•å·.html`
2. ç‚¹å‡»æ‰©å±•å›¾æ ‡
3. ç‚¹å‡»"å¯¼å‡ºä¸ºHTML"
4. æ£€æŸ¥ï¼š
   - âœ… å®Œå½¢å¡«ç©ºé¢˜å·æ˜¯å¦åªæœ‰ä¸€æ¡çº¿
   - âœ… å®Œå½¢å¡«ç©ºé€‰é¡¹è¡¨æ ¼æ˜¯å¦æ˜¾ç¤º
   - âœ… é˜…è¯»ç†è§£æ®µè½æ˜¯å¦åˆ†æ®µ

### é¢„æœŸæ•ˆæœ
- æ‰€æœ‰é¢˜å‹æ ¼å¼æ­£ç¡®
- æ‰“å°ç¾è§‚æ¸…æ™°
- æ— å†…å®¹ä¸¢å¤±

---

**ä¿®å¤å®Œæˆï¼æ‰€æœ‰é—®é¢˜å·²è§£å†³ï¼** ğŸ‰
